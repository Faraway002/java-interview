# 基本语法

## Java 基本介绍

Java 是一门面向对象的编程语言，不仅吸收了 C++ 语言的各种优点，还摒弃了 C++ 里难以理解的多继承、指针等概念，因此 Java 语言具有功能强大和简单易用两个特征。Java 语言作为静态面向对象编程语言的代表，极好地实现了面向对象理论，允许程序员以优雅的思维方式进行复杂的编程。

Java具有简单性、面向对象、分布式、健壮性、安全性、平台独立与可移植性、多线程、动态性等特点。Java 可以编写桌面应用程序、Web 应用程序、分布式系统和嵌入式系统应用程序等。如今，**Java 在 Web 应用程序和分布式系统中有着广泛的应用**。

### JRE / JDK / JVM

想要运行由 Java 语言编写的程序，就要有 **Java 运行环境（Java Runtime Environment，JRE）**；而想要编写 Java 程序，就需要有 **Java 开发工具包（Java Development Kit，JDK）**。

一个 JRE 通常包括 Java 虚拟机（JVM），Java 类库，Java 命令和其他的一些基础构件；而**一个 JDK 完全包含一个 JRE**，除了上述内容之外，JDK 还包含有 javac 编译器和其他工具（如 `javadoc` 和 `jdb`），JDK 能够创建和编译程序，是每个 Java 开发者必备的基础工具。

每一个 Java 运行环境都有一个 **Java 虚拟机（Java Virtual Machine，JVM）**，**所有的 Java 应用程序都在 JVM 上运行**。换句话说，任何一个操作系统平台上只要存在 Java 虚拟机，那么我们编写的应用程序就能在该系统上运行，这也是 Java "Write Once, Run Anywhere" 口号的来源。

> 直到今天，依然有很多人觉得跨平台是 Java 语言最大的优势。实际上，跨平台已经不是 Java 最大的卖点了，各种 JDK 新特性也不是，有很多更好用更简单的新语言不断地涌现出来。
>
> 在笔者看来，Java 强大的生态才是 Java 最强大的地方。

#### JDK 版本

JDK 版本现已来到 17（本文写于 2022-01-16），其中的长期支持版（Long Term Support，LTS）有 8、11、17。建议使用这三个版本的 JDK 进行开发，LTS 版本的 JDK 受官方支持的时间更长，同时很多第三方库也都是基于 JDK 的长期支持版更新的，许多公司使用的都是 8 和 11 的 JDK 版本。

> **OpenJDK 与 OracleJDK**
>
> OpenJDK 和 OracleJDK 有一段历史渊源，笔者这里就不详细展开了，直接说结论：
>
> * OpenJDK 是完全开源的，可以被看作是 JDK 的一个参考模型
> * OracleJDK 是由 Oracle 官方实现的 JDK，但是它并不是完全开源的
>
> OracleJDK 通常比 OpenJDK 更稳定。OpenJDK 和 OracleJDK 的代码几乎相同，但 OracleJDK 有更多的类和一些错误修复。因此，如果您想开发企业/商业软件，建议选择 OracleJDK，因为它经过了彻底的测试和稳定。
>
> 当然，由一些知名机构编译的 OpenJDK 也是值得信赖的，比如微软推出的 Microsoft OpenJDK，以及 Adopt OpenJDK。

#### 配置 JDK

在常见的操作系统上，都可以通过下载对应操作系统版本的 JDK 压缩包，解压放在一个目录上，然后配置环境变量的 `JAVA_HOME` 值为 JDK 根目录的路径，即可完成安装。

以 Windows 操作系统为例，下载压缩包，解压到一个地方，比如：

![image-20220505164425160](https://cdn.jsdelivr.net/gh/Faraway002/typora/images/image-20220505164425160.png)

然后在系统环境变量中配置一下即可：

![image-20220505164703843](https://cdn.jsdelivr.net/gh/Faraway002/typora/images/image-20220505164703843.png)

### .java 文件 和 .class 文件

**使用 Java 语言编写的代码源文件的后缀是 `.java`**，就像 C 语言的源文件后缀是 `.c` 那样。

**JDK 中提供了编译器 `javac` 程序，它可以把 `.java` 文件翻译成 `.class` 文件，也叫做类文件；类文件可以被装载到 JVM 上。**

如果一个 `.class` 文件含有一个 `main` 函数，那么它就可以被 JDK 提供的 `java` 程序加载到 JVM 上**运行**，该文件所其他需要的 `.class` 文件会被自动加载进去。

## 第一个 Java 程序

新建一个文本文档，复制下列代码到其中：

```java
public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Hello From Java!");
    }
}
```

保存为 `HelloWorld.java` 文件，使用 `javac HelloWorld.java` 编译为 `.class` 文件，然后使用 `java HelloWorld` 运行，结果应该为：

```Bash
$> javac HelloWorld.java
$> java HelloWorld
Hello From Java!
```

在 JDK 11 及以上版本中，对于单文件程序只需要使用 `java xxx.java` 即可直接运行。

> **jShell**
>
> jShell 是一个“读取-计算-打印循环”（Read-Evaluate-Print Loop，REPL），类似于 Python 命令行的交互式环境：键入一个 Java 语言表达式，jShell 会帮你计算出来并立即显示在屏幕上。
>
> 类似于常见的 CLI，使用 tab 键可以进行补全。

## Java 程序基本结构

Java 程序是由一个一个的类（class）组成的，所有函数（也叫方法）都被放在类里面。其中，有 `main` 方法的类为整个程序的入口。

**一个 Java 源文件可以有多个类，但是只能有一个公共类**，也就是  `public class`。**Java 源文件的名称必须和公共类的名称相同**。如果一个源文件没有公共类，那么它的名字可以是任意的。**每一个类都会被 `javac` 编译成单独的 `.class` 文件，`java` 程序能够加载的是含有 `main` 方法的类**。

`main` 方法的签名必须正确， `public static void main(String[] args)` 才是正确的，唯一可以变化的只有 `args` 这个方法参数名。如果运行正确，`main` 方法会默认返回一个 0 给计算机。

Java 程序的基本单位是一条一条的语句（statement），一条完整的语句由 `;` 结尾，一行可以有多条语句，但是不推荐这么做。

每一个方法的内容都以 `{ }` 包裹，被这样包裹住的代码也叫做代码块，每个块有自己独立的作用域。块是可以嵌套的，外层块中的内容在内层块中可以被访问，但是反过来则不行。

下面这个示例程序展示了 Java 的基本结构：

```java
public class Class1 {
    public void method1() {

    }
    
    public static void main(String[] args) {
        method1();
        new Class2().method2();
    }
}

class Class2 {
    public void method2() {
        
    }
}
```

## 注释

**注释是不会被执行的代码，通常用于说明代码的含义等**。

在 Java 中，分为三种注释：

1. 单行注释，以 `//` 开头，`//` 之后的代码全部被视为注释，换行后失效。

2. 多行注释，以 `/*` 开头，`*/` 结尾，之中的所有代码都被视为注释。 注意，多行注释中不能再包含多行注释，即 `/* /* */ */` 是非法的。

   > 非法指的是编写的程序中不符合编程语言的语法，编译器不能识别这种代码，并且报一个错误。

3. 文档注释，之后会详细介绍，它以 `/**` 开头，`*/` 结尾，可以看作是多行注释的一种，但是 Java 有特殊的方式处理它。

## 变量与常量

形如 `type var = xxx` 这样的语句叫做赋值语句，用于定义一个变量 `var`，并把 `xxx` 值给它。其中 type 表示该变量的类型。

变量名的命名规则：

1. 由数字，字母，`$` 以及 `_` 组成，不能以数字开头。
2. 不能和 Java 关键字冲突。

**Java 变量的命名应该清晰，它的用途决定了它的名字。**

除了上述规则还应该遵守以下规则：

1. 使用驼峰命名法。
2. 变量命名中不使用 `$` 和 `_`。尤其是 `$`，因为 `Java` 生成的一些类会使用这个符号，我们使用它的话会导致无法辨别该类是由谁编写的（生成的）。
3. 如果是常量，则应该使用 `_` 连接多个全大写的单词。

**Java 是一种强类型语言**，定义一个变量必须在变量名前加上它的类型，表示这个变量只能是这个类型。

> **变量与常量** 
>
> 变量即可变化的量，常量则是不可变化的量。

定义变量时，可以不立即进行赋值，但是并不能不赋值就参与运算，比如：

```java
int i = 1; // 定义并立即赋值

int j; // 先定义
j = 2; // 再赋值

int l;
i = l + j; // l 未赋值，错误
```

> 在 JDK 10 之后，可以使用 `var` 关键字定义一个变量，这个变量的类型会根据后面所赋的值自动推断。这时就必须在定义完变量后立即赋值。

### Java 的基本数据类型

Java 有 8 大基本数据类型：

1. 整数类型
   - `byte`，代表 8 位有符号整数。
   - `short`，代表 16 位有符号整数。
   - `int`，代表 32 位有符号整数。
   - `long`，代表 64 位有符号整数。
2. 浮点类型 浮点数有三个特殊值：NaN、无穷大以及无穷小，在溢出或非法运算时会使用到它们。
   - `float`，代表 32 位 IEEE 浮点数。
   - `double`，代表 64 位 IEEE 浮点数。
3. 布尔类型
   - `boolean`，取值只有 `true` 和 `false` 两种，表真假。 其所占位数和 JDK 实现有关，建议实现是 1 位，但是由于字节对齐的原因，可能实际上会是 8 位。
4. 字符类型
   - `char`，代表一个字符。有时需要多个 `char` 表示一个字符（Unicode 编码）。 字符在计算机中是通过编码的方式（即一个字符对应一个数字）表示的，这意味着字符本质上是一个个的整数。 在 Java 中，一个 `char` 占 16 位。而 `Unicode` 的字符总数超出了 16 位所能表示的最大数并且还在持续增加，但是 `char` 在这么多年的版本迭代中，仍然保持只占 16 位。这其中是如何解决的呢？更多内容请参阅《Java 核心技术 卷Ⅰ》。

**所有的复杂数据类型都由这 8 种数据类型组合而来**。

> **字符串** 
>
> 你可以使用 C 语言的思想：使用 `char` 的数组表示字符串，但是 Java 提供了更好的处理办法：使用 `String`（字符串类）。

### 数值类型之间的转换

基本原则：**所有低位数值类型转换到高位数值类型都是允许的，且不会出现任何问题，这样的转换叫做无信息丢失的转换。**

根据这一基本原则，我们可以得到下图，其中实线表示无信息丢失的转换，虚线则是有信息丢失的转换：

![img](https://cdn.jsdelivr.net/gh/Faraway002/typora/images/image-20220116144833431.png)

有丢失信息的转换是不被允许的，需要额外加上转换后的数据类型，如：

```java
int i = 1;
double j = 3.14;
i = j; // 编译失败
i = (double) j; // 编译通过
j = i; // 不需要加上类型信息也允许
```

**需要额外加上转换后的数据类型的转换叫做强制类型转换。**

### 常量

在声明变量时，如果在变量类型前加上一个 `final` 关键字，则该变量就变成了常量。这时就必须立马赋值（因为之后不可改变了）。

> 在讲到构造函数时会看到一种特殊情况。

#### 字面量

在 Java 程序中，直接写一个字面值也属于常量，也叫字面量。比如 `1`、`'a'`、`2.36`、`false` 等。

**整数类的字面量默认属于 `int` 类型，浮点数类的字面量默认属于 `double` 型，布尔类的字面量就属于 `boolean` 类型，字符类的字面量就属于 `char` 类型**。

如果在默认的字面量加上一些后缀，则该字面量就属于其他类型：

1. 在整数后加上一个 `L` 或 `l`，则变为长整型。
2. 在浮点数后加上一个 `F` 或 `f`，则变为 `float` 型。

需要注意的是，**以 `''` 包裹的单个字符（多个字符是非法的）的字面量属于字符字面量（`char`），而以 `""` 包裹的单个及多个字符的字面量属于字符串字面量（`String`）**。

> **字符字面量** 
>
> 有一些特殊的字符（比如换行，制表符）是无法直接写出来的，于是就利用 `\` + 一个字母的方式表示它，这叫做转义字符。比如 `'\n'` 表示一个换行符。 详细的转义字符表如下：
>
> ![img](https://cdn.jsdelivr.net/gh/Faraway002/typora/images/v2-187f4f87a8b8fabe29e4ef2c0b6004a6_r.jpg)

与字符串有关的内容会在之后会详细介绍。

> **整数的其他表示方法** 
>
> 整数在 Java 中，除了常见的十进制表示方法，还有二进制、八进制、十六进制的表示方法。
>
> - 以 `0b` 或 `0B` 开头的整数是二进制整数。
> - 以 `0` 开头的整数是八进制整数。
> - 以 `0x` 或 `0X` 开头的整数是十六进制整数。
>
> 还可以为数字添加下划线，这只是为了更方便阅读，对编译没有影响，如：
>
> ```java
> int a = 1_000_000;
> ```

## 运算符

Java 中运算符及其优先级如下表所示：

| 运算符                                                       | 结合性 |
| ------------------------------------------------------------ | ------ |
| `[]`, `()`（方法调用）                                       | 左     |
| `!`,` ~`, `++`, `--`, `+`（正号）, `-`（负号）, `()`（强制类型转换） | 右     |
| `*`, `/`, `%`                                                | 左     |
| `+`, `-`                                                     | 左     |
| `<<`, `>>`, `>>>`                                            | 左     |
| `<`, `<=`, `>`, `>=`, `instanceof`                           | 左     |
| `==`, `!=`                                                   | 左     |
| `&`                                                          | 左     |
| `^`                                                          | 左     |
| `|`                                                          | 左     |
| `&&`                                                         | 左     |
| `||`                                                         | 左     |
| `(boolean condition) ? a : b`                                | 右     |
| `=`, `+=`, `-=`, `*=`, `/=`, `%=`, `&=`,`|=`, `^=`, `~=`, `<<=`, `>>=`, `>>>=` | 右     |

可以使用 `()` 括起一个表达式，使它优先进行运算。

> **结合性** 
>
> 若有三个运算数和两个运算符：`a O b O c`，其中 `O` 为运算符，则左结合性表示为：`(a O b) O c`，右结合性则表示为：`a O (b O c)`。

注意关系运算符的“短路”问题。

## 输入与输出

### 输出

Java 最基本的命令行输出为 `System.out.println`、`System.out.print` 以及 `System.out.printf` 三个函数。

其本质是利用 Java 的输出流来输出到屏幕上，存在一个输出流绑定到了标准输出屏幕，而这个输出流又被绑定在 `System.out` 变量中。

`print` 与 `println` 都是输出一个字符串，不同之处在于 `println` 会额外输出一个换行符。

`printf` 用于格式化输出，本质上是调用 `String` 的 `format` 方法，之后会详细介绍。

### 输入

Java 使用 `Scanner` 类来从标准输入中读取输入。有关类的介绍见下一章。

要使用它，首先需要构造一个 `Scanner` 对象：

```java
Scanner in = new Scanner(System.in);
```

然后读取输入：

```java
int a = in.nextInt();
```

如果要读入其他类型，则是 `in.nextXXX()`，比如 `in.nextFloat()`。

可以使用 `in.next()` 和 `in.nextLine` 读取字符串，不同的是 `next()` 碰到空格等空白字符就会立即停止读取，而 `nextLine` 会一直读取直到读取到一个换行符。

还可以使用 `in.hasNext()` 或 `in.hasNextLine()` 判断是否还有输入。

> **踩坑**
>
> 如果要读取这样的输入：
>
> ```
> 3 4
> abcde
> abcd
> ```
>
> 这样的输入，那么你肯定会选择首先读取两个 `int`，也就是 `in.nextInt()` 调用两次；之后调用 `in.next()` 或 `in.hashNextLine` 读取两个字符串。
>
> 代码可能是这样：
>
> ```java
> public class InputDemo {
>     public static void main(String[] args) {
>         Scanner in = new Scanner(System.in);
>         int a = in.nextInt();
>         int b = in.nextInt();
>         String s1 = in.next(); // in.nextLine();
>         String s2 = in.next(); // in.nextLine();
>         
>         System.out.println("a = " + a);
>         System.out.println("b = " + b);
>         System.out.println("s1 = " + s1);
>         System.out.println("s2 = " + s2);
>     }
> }
> ```
>
> 但是很抱歉，如果你使用的是 `in.nextLine()`，则你会发现 a 读不到任何内容：
>
> ![image-20220505200837584](https://cdn.jsdelivr.net/gh/Faraway002/typora/images/image-20220505200837584.png)
>
> 这是因为第一个 `in.nextLine()` 读到了 4 后面的回车。
>
> 所以，如果你需要再用一个 `in.nextLine()` 把前面的回车读掉，这算是一个小坑吧。

## 流程控制

### 条件控制

如果要是程序在满足一个条件时执行一段代码，而不满足时执行另一段代码，就可以使用 `if` 条件控制语句。

它的标准语法是：

```java
if (condition) {
    
} else if (condition) {
    
} else {
}
```

其中，`else if` 可以有多个。

**`condition` 一定要是一个能够得到布尔值的表达式。**

比如：

```java
if (a > b) {
    System.out.println(a);
} else {
    System.out.println(b);
}
```

### 循环控制

有时我们希望一条语句能够执行多次，这时就需要用到循环控制。

循环有三大要点：

1. 循环结构，循环结构就是要重复执行的代码（段）
2. 循环变量，用于控制循环条件
3. 循环条件，和循环变量一起控制循环。当循环遍历满足循环条件时，继续循环；否则退出

基本的循环有三种：

- `for` 型：`for (循环变量定义; 循环条件; 更新循环变量) {循环体}`
- `do...while` 型：`do {循环体} while (循环条件)`
- `while` 型：`while (循环条件) {循环体}`

下面的程序使用了这三种循环，作用都是输出 1-10 之间的所有数字：

```java
for (int i = 1; i <= 10; ++i) {
    System.out.println(i);
}
// -------------------------------
int i = 1;
do {
    System.out.println(i);
    i++;
} while (i <= 10)
// -------------------------------
int i = 1;
while (i <= 10) {
    System.out.println(i);
    i++;
}    
```

### 中断流程控制

如果在循环（或接下来要介绍的多重选择控制语句）中，想要提前结束流程，则可以使用 `break` 或 `continue` 语句。

`break` 用于直接中断，而 `continue` 则是跳过本次。

比如上面的例子，当到 8 时，停止输出：

```java
for (int i = 1; i <= 10; ++i) {
    if (i == 8) {
        break;
    }
    System.out.println(i);
}
```

当到 8 时，跳过 8 直接输出之后的数：

```java
for (int i = 1; i <= 10; ++i) {
    if (i == 8) {
        continue;
    }
    System.out.println(i);
}
```

> **break-label 语句** 
>
> 可以通过 break-label 的语法指定跳到 label 所在的那层循环，比如：
>
> ```java
> outer: for (int i = 1; i <= 10; ++i) {
>     inner: for (int j = 1; j <= 10; ++j) {
>         if (j == 3) {
>             break outer;
>         }
>     }
> }
> ```
>
> 事实上，break-label 的语法可以用于任何语句而不仅仅是循环，但是这样的做法是不提倡的。
>
> `continue` 也是支持 continue-label 的。

### 多重选择控制

使用 `switch` 多重选择控制语句可以代替含有多个 `else-if` 的语句：

```java
switch (varName) {
    case value1:
        // xxx
      break;
    case value2:
        // yyy
        break;
    default:
        // zzz
        break;
}
```

注意，如果某个 `case` 没有 `break`，则会一直执行下去，直到碰到一个 `break` 或执行完毕。

`switch` 语句中的变量的类型可以是：

- `char`、`byte`、`short`、`int` 的字面值
- 枚举常量（枚举会单独介绍）
- 字符串字面值

## 数组

**数组用于存储多个相同类型的值**，基本定义语法为：

```java
type[] arrName = new type[arrSize];
```

之后就可以通过 `arrName[i]` 的语法访问数组中的第 `i` 个位置，对这个位置上对应的值进行操作。

数组也具有字面值，即：`{ele1, ele2, ele3}`，它可以被赋给一个数组变量，比如：

```java
int[] arr = {1, 2, 3};
```

甚至还有匿名数组，所谓匿名，即一个数组类型没有直接赋值给一个数组变量：

```java
int len = new int[] {1, 2, 3}.length; // len 的值为 3
```

数组初始化之后，是可以直接访问的，它内部的每一个值都是该类型的默认值，对于数值类型，默认值是 0；对于布尔类型，默认值是 `false`；对于还未介绍的对象类型，默认是 `null`。

### 多维数组

**多维数组是数组的数组**，即数组里保存数组：

```java
type[][] arrName = new type[row][column];
```

多维数组也有字面量，即：

```java
int[][] arr = {
    {1, 2, 3},
    {4, 5, 6}
};
```

可以只访问多维数组的某一行（即一个数组），这意味着在初始化时可以只写 `row` 而省略 `column`，之后再单独对每一行进行初始化。

> **数组的拷贝** 
>
> 由于 Java 是总是按值调用，而非按引用调用，因此把一个变量赋给另一个变量的本质就是把一个变量的值拷贝一份给另一个变量。 
>
> **数组的本质是对象**。对象的存储方式是：真实存储对象内容的空间分配在堆上，对象变量分配在栈上，对象变量和对象实际存储空间使用指针对应。 所以对象变量的本质是一个个地址，因此把一个数组变量赋值给另一个数组变量会导致两个数组变量指向同一个数组。 
>
> 要进行真实的拷贝，需要调用 `Arrays` 类的 `copyOf` 方法或者 `System` 的 `arraycopy` 方法，之后会详细讲解。

### for-each 循环

对数组来说，如果只是想访问数组中的元素而不想访问其下标，可以使用 for-each 循环的语法。

for-each 循环的语法是：`for (type elem : type[] array)`。

比如：

```java
int[][] arr = {
    {1, 2, 3},
    {4, 5, 6}
};

int sum = 0;
for (int[] row : arr) {
    for (int num : row) {
        sum += num;
    }
}
System.out.println(sum);
```